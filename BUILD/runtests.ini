set -n console log=tests-log.txt
set console debug=log
set cpu idle
;set cpu debug
;set mmu debug
set drum debug
;set disk debug
;
; Initializing the magnetic drums.
;
attach -e drum1 data/CAMdrum20.bin
; Attaching an output file.
;
attach -n prn0 output.txt
; Attachng FS-1500 input image
attach fs0 FSINP.TXT


;
; Enabling the true LRU behavior of caches
; slows down the simulation speed ~20%
;
;set mmu cache

echo ###
echo ### Zeroing out the first page of RAM (as would be entered from
echo ### switch registers after powering up the machine,
echo ### likely about once a year or less).
echo ###

d -ml 1 xta, vtm 1777(1)
d -ml 2 atx (1), utm -1(1)
d -ml 3 v1m 2(1), stop

;run 1

d -ml 4 xta 7, ext 2
d -ml 5 stop, uj 5

d 6 0000 0000 0000 0000
d 7 0000 0000 0177 0004
d 7 0000 0000 0144 0004
d 7 0000 0000 0140 0000
d 7 0000 0000 0140 0004

echo ### load test
run -l 4

echo ### 
echo ### Done; data cache registers are displayed above. An error message
echo ### would be usually displayed there after a STOP instruction.
echo ### Naturally, at the moment they all contain zeros. Booting the OS now...
echo ###

e 1-7

;set cpu debug
;dump memory
;expect  "sim>"
;run -l 10
;cont
